<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ r.name }} - HMS Researcher</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
    <nav class="bg-gray-800 border-b border-gray-700 px-6 py-4">
        <div class="max-w-5xl mx-auto">
            <a href="/" class="text-gray-400 hover:text-white text-sm">← Back to all researchers</a>
        </div>
    </nav>

    <main class="max-w-5xl mx-auto px-6 py-8">
        <!-- Header -->
        <div class="bg-gray-800 rounded-lg border border-gray-700 p-6 mb-6">
            <div class="flex justify-between items-start">
                <div>
                    <h1 class="text-3xl font-bold text-white mb-2">{{ r.name }}</h1>
                    {% if r.orcid %}
                    <a href="{{ r.orcid }}" target="_blank" class="text-green-400 hover:underline text-sm">
                        {{ r.orcid }}
                    </a>
                    {% endif %}
                </div>
                <div class="text-right">
                    <div class="text-5xl font-bold text-green-400">{{ r.h_index }}</div>
                    <div class="text-sm text-gray-400">H-Index</div>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-4 gap-4 mt-6">
                <div class="bg-gray-700 rounded-lg p-4 text-center">
                    <div class="text-2xl font-bold text-white">{{ "{:,}".format(r.works_count) }}</div>
                    <div class="text-xs text-gray-400">Publications</div>
                </div>
                <div class="bg-gray-700 rounded-lg p-4 text-center">
                    <div class="text-2xl font-bold text-yellow-400">{{ "{:,}".format(r.cited_by_count) }}</div>
                    <div class="text-xs text-gray-400">Citations</div>
                </div>
                <div class="bg-gray-700 rounded-lg p-4 text-center">
                    <div class="text-2xl font-bold text-blue-400">{{ "%.2f"|format(r.two_yr_citedness) }}</div>
                    <div class="text-xs text-gray-400">2yr Mean Citedness</div>
                </div>
                <div class="bg-gray-700 rounded-lg p-4 text-center">
                    <div class="text-2xl font-bold text-purple-400">{{ r.i10_index }}</div>
                    <div class="text-xs text-gray-400">i10-Index</div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-6">
            <!-- Topics -->
            <div class="bg-gray-800 rounded-lg border border-gray-700 p-6">
                <h2 class="text-xl font-semibold text-red-400 mb-4">Research Topics</h2>
                {% if r.topics %}
                <ul class="space-y-2">
                    {% for t in r.topics %}
                    <li class="flex justify-between items-center">
                        <span class="text-gray-200">{{ t.name }}</span>
                        <span class="text-gray-500 text-sm">{{ t.count }} works</span>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="text-gray-500">No topics available</p>
                {% endif %}
            </div>

            <!-- Affiliations -->
            <div class="bg-gray-800 rounded-lg border border-gray-700 p-6">
                <h2 class="text-xl font-semibold text-red-400 mb-4">Affiliations</h2>
                {% if r.affiliations %}
                <ul class="space-y-2">
                    {% for a in r.affiliations %}
                    <li class="flex justify-between items-center">
                        <span class="text-gray-200">{{ a.name }}</span>
                        <span class="text-gray-500 text-sm">{{ a.type }} · {{ a.country }}</span>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="text-gray-500">No affiliations available</p>
                {% endif %}
            </div>
        </div>

        <!-- Publication History Chart -->
        {% if r.counts_by_year %}
        <div class="bg-gray-800 rounded-lg border border-gray-700 p-6 mt-6">
            <h2 class="text-xl font-semibold text-red-400 mb-4">Publication & Citation History</h2>
            <div class="h-64">
                <canvas id="historyChart"></canvas>
            </div>
        </div>

        <script>
        const countsData = {{ r.counts_by_year | tojson }};
        const years = Object.keys(countsData).sort();
        const works = years.map(y => countsData[y].works);
        const citations = years.map(y => countsData[y].cited);

        const ctx = document.getElementById('historyChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: years,
                datasets: [
                    {
                        label: 'Publications',
                        data: works,
                        backgroundColor: 'rgba(239, 68, 68, 0.7)',
                        yAxisID: 'y'
                    },
                    {
                        label: 'Citations',
                        data: citations,
                        type: 'line',
                        borderColor: '#fbbf24',
                        backgroundColor: 'rgba(251, 191, 36, 0.1)',
                        yAxisID: 'y1',
                        tension: 0.3
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: { color: '#9ca3af' }
                    }
                },
                scales: {
                    x: {
                        grid: { color: 'rgba(255,255,255,0.1)' },
                        ticks: { color: '#9ca3af' }
                    },
                    y: {
                        type: 'linear',
                        position: 'left',
                        grid: { color: 'rgba(255,255,255,0.1)' },
                        ticks: { color: '#9ca3af' },
                        title: { display: true, text: 'Publications', color: '#9ca3af' }
                    },
                    y1: {
                        type: 'linear',
                        position: 'right',
                        grid: { display: false },
                        ticks: { color: '#fbbf24' },
                        title: { display: true, text: 'Citations', color: '#fbbf24' }
                    }
                }
            }
        });
        </script>
        {% endif %}

        <!-- OpenAlex Link -->
        <div class="mt-6 text-center">
            <a href="https://openalex.org/{{ r.id }}" target="_blank"
               class="text-blue-400 hover:underline text-sm">
                View on OpenAlex →
            </a>
        </div>
    </main>
</body>
</html>
